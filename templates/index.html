<!-- templates/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>EAF Generator - Shaastra26</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 30px; }
    .file-list { margin-top: 8px; font-size: 0.9rem; }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>EAF Generator - Shaastra2026</h2>
      <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning">
          {% for msg in messages %} <div>{{ msg }}</div> {% endfor %}
        </div>
      {% endif %}
    {% endwith %}


    <form method="post" enctype="multipart/form-data">

      <!-- Date -->
      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Date</label>
        <div class="col-sm-4">
          <input type="date" class="form-control" name="date" value="{{''}}">
        </div>
      </div>

      <!-- Amount and Amount Words -->
      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Amount (â‚¹)</label>
        <div class="col-sm-4">
          <input type="number" step="0.01" class="form-control" name="amount" placeholder="e.g. 12345" required>
        </div>
        <label class="col-sm-2 col-form-label">Amount (Words)</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" name="amount_words" placeholder="Leave blank to auto-generate">
        </div>
      </div>

      <!-- Purpose / Remarks -->
      <div class="mb-3">
        <label class="form-label">Purpose / Remarks</label>
        <textarea class="form-control" name="purpose" rows="3" placeholder="Short description of expense" required></textarea>
      </div>

      <!-- Bank Details (Optional) -->
      <h5 class="mt-4">Bank Details</h5>
      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Existing Details</label>
        <div class="col-sm-4">
          <select class="form-select" id="existingDetails" name="existing" onchange="fillBankDetails(this)">
            <option selected disabled>Choose...</option>
            <option value="eshwar">Eshwar</option>
            <option value="siddhi">Siddhi</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Account Number</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" id="accountNumber" name="account_number">
        </div>
        <label class="col-sm-2 col-form-label">Account Holder Name</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" id="accountHolder" name="account_holder">
        </div>
      </div>
      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Bank Name</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" id="bankName" name="bank_name">
        </div>
        <label class="col-sm-2 col-form-label">IFSC Code</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" id="ifsc" name="ifsc">
        </div>
      </div>
      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">Branch</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" id="branch" name="branch">
        </div>
      </div>




      <!-- Upload Bills -->
      <div class="mb-3">
        <label class="form-label">Upload Bills (PDF / JPG / PNG). Multiple allowed</label>
        <input class="form-control" type="file" name="bills" multiple accept=".pdf,.png,.jpg,.jpeg" required>
        <div class="file-list text-muted">Tip: upload all bills for this request. Images will be auto-converted to PDFs.</div>
      </div>

      <!-- Custom filenames -->
      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label">PDF Name</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" name="filename" placeholder="e.g. EAF_NAME" required>
        </div>
      </div>

      <!-- Submit button -->
      <button class="btn btn-primary">Generate & Download PDFs</button>
    </form>

    <hr>
    <p class="text-muted small">
      Built for Shaastra finance workflow. After download you can upload the final bundle to Drive / attach to emails / track in your GSheet.
    </p>
  </div>

  <script>
    function fillBankDetails(select) {
      const accountNumber = document.getElementById("accountNumber");
      const accountHolder = document.getElementById("accountHolder");
      const bankName = document.getElementById("bankName");
      const ifsc = document.getElementById("ifsc");
      const branch = document.getElementById("branch");

      if (select.value === "eshwar") {
        accountNumber.value = "0862100100001911";
        accountHolder.value = "Vuppala Eshwar Sai";
        bankName.value = "Punjab National Bank";
        ifsc.value = "PUNB0086210";
        branch.value = "Gurbabadhi road, Nizamabad";
      } else if (select.value === "siddhi") {
        accountNumber.value = "50100807816820";
        accountHolder.value = "Siddhi Govind Singh";
        bankName.value = "HDFC Bank";
        ifsc.value = "HDFC0004690";
        branch.value = "Bodhale Nagar";
      } else {
        // Clear values for "Other"
        accountNumber.value = "";
        accountHolder.value = "";
        bankName.value = "";
        ifsc.value = "";
        branch.value = "";
      }
    }

    window.addEventListener("beforeunload", function () {
      navigator.sendBeacon("{{ url_for('logout') }}");
    });
  </script>

</body>
</html>
